<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>è‡ªç«‹å¤§å†’éšªï½œå®Œæ•´å››å¤§APPï¼‹äº‹ä»¶ï¼‹æ¸¬é©—ï¼‹å•†åº—</title>

  <!-- React / ReactDOM -->
  <script crossorigin="anonymous" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin="anonymous" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel (JSX) -->
  <script crossorigin="anonymous" src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#1f1f23;
      --panel:#ffffff;
      --ink:#111;
      --muted:#666;
      --shadow: 6px 6px 0 #000;
      --shadow-sm: 3px 3px 0 #000;
      --border: 3px solid #000;
      --radius: 16px;
      --radius-lg: 36px;
      --font: "Noto Sans TC", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      --pixel: "VT323", monospace;

      --ok:#16a34a;
      --bad:#dc2626;
      --warn:#f59e0b;
      --info:#2563eb;
      --vio:#7c3aed;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 50% 20%, #3b3b44, var(--bg));
      font-family: var(--font);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      color:var(--ink);
    }

    #root{
      width: min(980px, 98vw);
      height: min(920px, 96vh);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* Phone frame */
    .frame{
      width: min(520px, 96vw);
      height: min(900px, 96vh);
      background:#000;
      border: 4px solid #444;
      border-radius: var(--radius-lg);
      padding: 12px;
      box-shadow: 0 24px 60px rgba(0,0,0,.55);
      position:relative;
    }
    .screen{
      width:100%;
      height:100%;
      background: #f5f5f5;
      border-radius: calc(var(--radius-lg) - 10px);
      overflow:hidden;
      position:relative;
      display:flex;
      flex-direction:column;
    }
    .notch{
      position:absolute;
      top:0;
      left:50%;
      transform:translateX(-50%);
      width: 180px;
      height: 30px;
      background:#000;
      border-bottom-left-radius: 16px;
      border-bottom-right-radius: 16px;
      z-index:50;
    }

    .topbar{
      background:#0f172a;
      color:#fff;
      padding: 10px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-family: var(--pixel);
      font-size: 18px;
      border-bottom: 4px solid #000;
      min-height: 52px;
    }
    .topbar .pill{
      background:#111827;
      padding: 4px 10px;
      border:2px solid #000;
      font-family: var(--font);
      font-weight:900;
      font-size:12px;
      border-radius: 999px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      max-width: 70%;
    }
    .pill b{ color:#fff; }
    .pill .k{ opacity:.85; }
    .pill .v{ font-weight:900; }

    .page{
      flex:1;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .content{
      flex:1;
      overflow:auto;
      padding: 18px 16px 16px;
      min-height:0;
    }

    .h1{
      font-family: var(--pixel);
      font-size: 54px;
      margin: 6px 0 6px;
      text-align:center;
      letter-spacing:1px;
    }
    .sub{
      text-align:center;
      color:#222;
      font-weight:900;
      margin: 0 0 16px;
    }

    .card{
      background: var(--panel);
      border: var(--border);
      box-shadow: var(--shadow);
      border-radius: 14px;
      padding: 14px;
    }
    .card + .card{ margin-top: 14px; }

    .row{
      display:flex;
      gap:12px;
      align-items:stretch;
    }
    .col{ flex:1; min-width:0; }

    .label{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      margin-bottom:4px;
    }
    .big{
      font-family: var(--pixel);
      font-size: 40px;
      font-weight:900;
      line-height:1;
    }
    .small{
      font-size: 13px;
      font-weight:800;
      color:#111;
      line-height:1.45;
    }

    /* Buttons */
    .btn{
      width:100%;
      padding: 14px 14px;
      border: var(--border);
      background:#111;
      color:#fff;
      font-weight:900;
      font-size: 16px;
      border-radius: 12px;
      cursor:pointer;
      box-shadow: var(--shadow-sm);
    }
    .btn:active{ transform: translate(2px,2px); box-shadow: 1px 1px 0 #000; }
    .btn-secondary{ background:#fff; color:#111; }
    .btn-blue{ background: var(--info); }
    .btn-green{ background: var(--ok); }
    .btn-red{ background: var(--bad); }
    .btn-orange{ background: var(--warn); color:#111; }
    .btn-vio{ background: var(--vio); }

    .btn[disabled]{
      opacity:.55;
      cursor:not-allowed;
      transform:none !important;
      box-shadow: var(--shadow-sm);
    }

    .badge{
      display:inline-block;
      font-size:12px;
      font-weight:900;
      padding: 2px 8px;
      border:2px solid #000;
      border-radius: 999px;
      background:#fde68a;
    }
    .badge.gray{ background:#e5e7eb; }
    .badge.ok{ background:#bbf7d0; }
    .badge.bad{ background:#fecaca; }
    .badge.info{ background:#bfdbfe; }
    .badge.vio{ background:#ddd6fe; }

    /* Wheel */
    .wheel-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 10px 0 18px;
      position:relative;
    }
    .wheel-shell{
      width: 200px;
      height: 200px;
      position:relative;
    }
    .wheel{
      width: 200px;
      height: 200px;
      border-radius: 999px;
      border: 8px solid #000;
      box-shadow: var(--shadow);
      position:absolute;
      inset:0;
      overflow:hidden;
      background:
        conic-gradient(
          #ef4444 0 45deg,
          #f59e0b 45deg 90deg,
          #22c55e 90deg 135deg,
          #3b82f6 135deg 180deg,
          #a855f7 180deg 225deg,
          #ef4444 225deg 270deg,
          #f59e0b 270deg 315deg,
          #22c55e 315deg 360deg
        );
    }
    .wheel::after{
      content:"?";
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: var(--pixel);
      font-size: 88px;
      font-weight:900;
      color:#000;
      text-shadow: 2px 2px 0 #fff;
    }
    .pointer{
      width:0;height:0;
      border-left: 14px solid transparent;
      border-right:14px solid transparent;
      border-top: 28px solid #000;
      position:absolute;
      top:-18px;
      left:50%;
      transform: translateX(-50%);
      z-index:5;
    }
    @keyframes spin { from{ transform:rotate(0deg);} to{ transform:rotate(360deg);} }
    .spinning{ animation: spin .12s linear infinite; transform-origin: 50% 50%; }

    /* Home area */
    .money-bar{
      padding: 12px 14px;
      background:#fff;
      border-bottom: 4px solid #000;
    }
    .money-title{ font-size:12px; color:#777; font-weight:900; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .money{
      font-family: var(--pixel);
      font-size: 50px;
      font-weight:900;
      margin-top: 2px;
      line-height:1;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }
    .money .mini{
      font-family: var(--font);
      font-size: 12px;
      font-weight:900;
      color:#222;
      display:flex;
      gap:8px;
      align-items:center;
      padding-bottom: 4px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 14px;
    }
    .app{
      border: var(--border);
      background:#fff;
      border-radius: 14px;
      box-shadow: var(--shadow-sm);
      padding: 12px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
      min-height: 120px;
      font-weight:900;
      text-align:center;
      user-select:none;
    }
    .app:active{ transform: translate(2px,2px); box-shadow: 1px 1px 0 #000; }
    .app .icon{
      width:54px;height:54px;
      border: var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 12px;
      font-family: var(--pixel);
      font-size: 28px;
      background:#e5e7eb;
    }
    .app.orange .icon{ background:#fdba74; }
    .app.blue .icon{ background:#93c5fd; }
    .app.green .icon{ background:#86efac; }
    .app.purple .icon{ background:#d8b4fe; }

    .footer{
      padding: 12px 14px;
      border-top: 4px solid #000;
      background:#0f172a;
      color:#fff;
      height: 240px;
      display:flex;
      flex-direction:column;
      min-height: 240px;
    }
    .log-title{
      font-family: var(--pixel);
      font-size: 18px;
      font-weight:900;
      color:#22c55e;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom: 1px solid rgba(255,255,255,.2);
      padding-bottom: 6px;
      margin-bottom: 8px;
    }
    .logs{
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";
      font-size: 13px;
      line-height: 1.5;
      color:#22c55e;
      font-weight:900;
      min-height:0;
    }
    .log{
      border-left: 4px solid rgba(34,197,94,.4);
      padding-left: 8px;
      margin-bottom: 10px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* modal */
    .overlay{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.75);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index:100;
    }
    .modal{
      width: min(440px, 100%);
      max-height: min(760px, 86vh);
      overflow:auto;
      background:#fff;
      border: var(--border);
      box-shadow: var(--shadow);
      border-radius: 16px;
      padding: 14px;
    }
    .modal-title{
      display:inline-block;
      background:#000;
      color:#fff;
      font-family: var(--pixel);
      font-size: 22px;
      padding: 6px 10px;
      border: 2px solid #fff;
      transform: translateY(-18px) rotate(-2deg);
      margin-bottom: -6px;
    }
    .opt{
      width:100%;
      text-align:left;
      padding: 12px;
      border: var(--border);
      background:#f3f4f6;
      border-radius: 12px;
      cursor:pointer;
      font-weight:900;
      margin-top: 10px;
      box-shadow: var(--shadow-sm);
    }
    .opt:active{ transform: translate(2px,2px); box-shadow: 1px 1px 0 #000; }
    .hint{ font-size:12px; color:#666; margin-top: 6px; font-weight:900; }
    .hr{ height:1px; background:#000; opacity:.15; margin: 10px 0; }

    .two{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .kv{
      padding:10px;
      border: var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow-sm);
      background:#fff;
    }
    .kv .k{ font-size:12px; color:#666; font-weight:900; }
    .kv .v{ font-family: var(--pixel); font-size: 28px; font-weight:900; margin-top:2px; }

    .chiprow{ display:flex; flex-wrap:wrap; gap:8px; margin-top: 8px; }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 4px 8px;
      border:2px solid #000;
      border-radius: 999px;
      font-size:12px;
      font-weight:900;
      background:#e5e7eb;
    }
    .chip.ok{ background:#bbf7d0; }
    .chip.bad{ background:#fecaca; }
    .chip.info{ background:#bfdbfe; }
    .chip.vio{ background:#ddd6fe; }

    /* Scrollbar */
    .content::-webkit-scrollbar{ width: 8px; }
    .content::-webkit-scrollbar-thumb{ background:#111; border-radius: 999px; }
    .logs::-webkit-scrollbar{ width: 8px; }
    .logs::-webkit-scrollbar-thumb{ background:#16a34a; border-radius: 999px; }
    .modal::-webkit-scrollbar{ width: 8px; }
    .modal::-webkit-scrollbar-thumb{ background:#111; border-radius: 999px; }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    // -------------------------
    // Utils
    // -------------------------
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const rint = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;
    const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const nowTs = () => Date.now();

    const STORAGE_KEY = "independence_game_v1_full";

    function loadSave(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return null;
        const obj = JSON.parse(raw);
        if(!obj || !obj.version) return null;
        return obj;
      }catch(e){
        return null;
      }
    }
    function saveGame(payload){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      }catch(e){}
    }
    function clearSave(){
      try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
    }

    // -------------------------
    // Core Data
    // -------------------------
    const ORIGINS = [
      { grade:'A', money:0,    desc:'èº«ç„¡åˆ†æ–‡ï¼šèµ·æ­¥æ›´è¾›è‹¦ï¼Œä½†ä½ æœ‰æ©Ÿæœƒé ç­–ç•¥ç¿»ç›¤ã€‚', prob:0.10 },
      { grade:'B', money:2000, desc:'å‹‰å¼·é¤¬å£ï¼šå£“åŠ›åé«˜ï¼Œéœ€ç²¾æ‰“ç´°ç®—ã€‚', prob:0.30 },
      { grade:'C', money:4000, desc:'ç¨æœ‰ç©è“„ï¼šä¸€èˆ¬èµ·æ­¥ï¼Œå®¹éŒ¯ç©ºé–“ä¸­ç­‰ã€‚', prob:0.30 },
      { grade:'D', money:6000, desc:'ä¸€èˆ¬å°åº·ï¼šå¯å¤šæŠ•è³‡è‡ªæˆ‘æå‡ã€‚', prob:0.20 },
      { grade:'E', money:8000, desc:'è³‡æºè¼ƒå¤šï¼šåˆ¥å¤§æ„ï¼Œè©é¨™èˆ‡è¡å‹•æ¶ˆè²»ä»æœƒè®“ä½ ç¿»è»Šã€‚', prob:0.10 },
    ];
    function pickOrigin(){
      const r = Math.random();
      let acc = 0;
      for(const o of ORIGINS){
        acc += o.prob;
        if(r <= acc) return o;
      }
      return ORIGINS[ORIGINS.length - 1];
    }

    const HOUSING_OPTIONS = [
      {
        id:"room_shared",
        name:"åˆç§Ÿé›…æˆ¿",
        rent:2500,
        deposit:2500,
        safety:+2,
        mood:+2,
        note:"è²»ç”¨ä½ï¼Œä½†å®¤å‹äº’å‹•å½±éŸ¿å¿ƒæƒ…ï¼›è¦ç°½ç´„ã€é»äº¤ã€‚"
      },
      {
        id:"studio",
        name:"åˆ†ç§Ÿå¥—æˆ¿",
        rent:4200,
        deposit:4200,
        safety:+4,
        mood:+1,
        note:"ç›¸å°ç©©å®šï¼Œä½†è²»ç”¨æé«˜ï¼›æ³¨æ„æŠ¼é‡‘æ¢æ¬¾ã€ä¿®ç¹•è²¬ä»»ã€‚"
      },
      {
        id:"illegal_topup",
        name:"è¶…ä¾¿å®œã€å…æŠ¼é‡‘ã€å»£å‘Šæˆ¿",
        rent:1800,
        deposit:0,
        safety:-10,
        mood:-2,
        scamRisk:+20,
        note:"é«˜é¢¨éšªï¼šå‡æˆ¿æ±/é‡£é­šé€£çµ/è¦æ±‚åŒ¯æ¬¾ä¿ç•™ã€‚"
      },
      {
        id:"no_home",
        name:"æš«ç„¡å›ºå®šä½æ‰€",
        rent:0,
        deposit:0,
        safety:-6,
        mood:-6,
        note:"çŸ­æœŸçœéŒ¢ä½†èº«å¿ƒæ¶ˆè€—å¤§ï¼Œäº‹ä»¶é¢¨éšªä¸Šå‡ã€‚"
      }
    ];

    const JOB_OPTIONS = [
      {
        id:"parttime_store",
        name:"ä¾¿åˆ©å•†åº—å…¼è·",
        weeklyPay:1200,
        mood:-2,
        health:-1,
        security:+0,
        note:"æ’ç­å½ˆæ€§ä¸€èˆ¬ï¼›ç´¯ç©å·¥ä½œç¶“é©—ã€‚"
      },
      {
        id:"delivery",
        name:"å¤–é€æ¥å–®",
        weeklyPay:1600,
        mood:-3,
        health:-3,
        security:-2,
        note:"æ”¶å…¥è¼ƒé«˜ä½†é¢¨éšªèˆ‡ç–²å‹åé«˜ï¼›æ³¨æ„äº¤é€šå®‰å…¨ã€‚"
      },
      {
        id:"office_assist",
        name:"è¡Œæ”¿åŠ©ç†(è¨ˆæ™‚)",
        weeklyPay:1400,
        mood:-1,
        health:-1,
        security:+1,
        note:"è¼ƒç©©å®šï¼›éœ€è¦æº–æ™‚èˆ‡åŸºæœ¬æ–‡æ›¸èƒ½åŠ›ã€‚"
      },
      {
        id:"shady_job",
        name:"ã€é«˜è–ªè¼•é¬†ã€ç¥ç§˜å·¥ä½œ",
        weeklyPay:2600,
        mood:+0,
        health:+0,
        security:-12,
        scamRisk:+25,
        note:"é«˜é¢¨éšªï¼šäººé ­å¸³æˆ¶/ä»£æ”¶æ¬¾/è·‘è…¿é ˜ç¾é‡‘ã€‚"
      },
      {
        id:"unemployed",
        name:"æš«ç„¡å·¥ä½œ",
        weeklyPay:0,
        mood:-4,
        health:+0,
        security:+0,
        note:"çŸ­æœŸä¼‘æ¯ï¼Œä½†è²¡å‹™å£“åŠ›èˆ‡å¿ƒæƒ…é¢¨éšªæé«˜ã€‚"
      }
    ];

    const SHOP_ITEMS = [
      { id:"earplugs", name:"è€³å¡", price:120, effects:{ mood:+3 }, note:"æå‡ç¡çœ å“è³ªã€‚"},
      { id:"firstaid", name:"ç°¡æ˜“æ€¥æ•‘åŒ…", price:300, effects:{ health:+5 }, note:"æ„å¤–äº‹ä»¶å¯æ¸›å‚·ã€‚"},
      { id:"simlock", name:"SIM å¡é–/é˜²è©è¨­å®š", price:200, effects:{ security:+6 }, note:"é™ä½è©é¨™äº‹ä»¶å½±éŸ¿ã€‚"},
      { id:"meal", name:"é¤åˆ¸(æœ¬é€±)", price:250, effects:{ health:+3, mood:+2 }, note:"é€±çµç®—æ™‚æ¸›å°‘ç–²å‹ã€‚"},
      { id:"notebook", name:"è¨˜å¸³æœ¬", price:80, effects:{ security:+1, mood:+1 }, note:"å®Œæˆæ¸¬é©—æ™‚é¡å¤–åŠ æˆã€‚"},
    ];

    const QUIZ_BANK = [
      {
        id:"q1",
        q:"çœ‹åˆ°ã€æˆ¿æ±è¦æ±‚å…ˆåŒ¯æ¬¾ä¿ç•™ã€ï¼Œæœ€å®‰å…¨çš„åšæ³•ï¼Ÿ",
        options:[
          {t:"ç«‹åˆ»åŒ¯æ¬¾ä»¥å…è¢«æ¶èµ°", ok:false},
          {t:"å …æŒçœ‹æˆ¿ã€æ ¸å°èº«åˆ†ã€ç°½ç´„å¾Œå†ä»˜æ¬¾", ok:true},
          {t:"æŠŠèº«åˆ†è­‰æ­£åé¢å…ˆå‚³çµ¦å°æ–¹", ok:false},
          {t:"æ”¹ç”¨é»æ•¸æˆ–è™›æ“¬è²¨å¹£ä»˜æ¬¾", ok:false},
        ],
        explain:"ç§Ÿå±‹äº¤æ˜“ä»¥ã€çœ‹æˆ¿ã€é»äº¤ã€åˆç´„ã€æ”¶æ“šã€ç‚ºå„ªå…ˆï¼Œé¿å…å…ˆåŒ¯æ¬¾ã€‚"
      },
      {
        id:"q2",
        q:"é™Œç”Ÿäººèªªã€å¹«ä½ ä»£æ”¶æ¬¾ã€çµ¦ä½ æŠ½æˆã€ï¼Œä½ è©²ï¼Ÿ",
        options:[
          {t:"å…ˆåšä¸€æ¬¡è©¦è©¦çœ‹", ok:false},
          {t:"æ‹’çµ•ä¸¦ä¿ç•™å°è©±ç´€éŒ„ï¼Œå¿…è¦æ™‚æ±‚åŠ©", ok:true},
          {t:"æŠŠå¸³æˆ¶å€Ÿä»–ç”¨ï¼Œè‡ªå·±ä¸ç¢°éŒ¢å°±æ²’äº‹", ok:false},
          {t:"è«‹ä»–æ”¹ç”¨ä½ å®¶äººå¸³æˆ¶", ok:false},
        ],
        explain:"äººé ­å¸³æˆ¶èˆ‡ä»£æ”¶æ¬¾é¢¨éšªé«˜ï¼Œå¯èƒ½æ¶‰åˆ‘è²¬ã€‚"
      },
      {
        id:"q3",
        q:"è¨˜å¸³çš„ç›®çš„æœ€è²¼è¿‘ä¸‹åˆ—ä½•è€…ï¼Ÿ",
        options:[
          {t:"æŠŠæ¯ä¸€ç­†èŠ±è²»éƒ½å¯«å¾—å¾ˆæ¼‚äº®", ok:false},
          {t:"äº†è§£éŒ¢æµå‘ï¼Œåšå‡ºèƒ½ç¶­æŒç”Ÿæ´»çš„é ç®—é¸æ“‡", ok:true},
          {t:"åªè¨˜å¤§é¡ï¼Œå…¶ä»–ä¸ç”¨ç®¡", ok:false},
          {t:"è¨˜å¸³ç­‰æ–¼çœéŒ¢ï¼Œä¸éœ€è¦è¦åŠƒ", ok:false},
        ],
        explain:"è¨˜å¸³æ˜¯ã€çœ‹è¦‹ç¾æ³ã€ï¼Œé ç®—æ‰æ˜¯ã€åšå‡ºé¸æ“‡ã€ã€‚"
      },
      {
        id:"q4",
        q:"æ‰‹æ©Ÿå¯†ç¢¼è¨­å®šï¼Œä»¥ä¸‹å“ªå€‹æœ€ä¸å»ºè­°ï¼Ÿ",
        options:[
          {t:"é•·åº¦è¶³å¤ ã€é¿å…å¸¸è¦‹åºåˆ—", ok:true},
          {t:"ç”¨ 123456 / 0000 é€™é¡å¸¸è¦‹å¯†ç¢¼", ok:false},
          {t:"é–‹å•Ÿé›™é‡é©—è­‰(2FA)", ok:true},
          {t:"å®šæœŸæ›´æ–°ã€ä¸åŒæœå‹™ä¸åŒå¯†ç¢¼", ok:true},
        ],
        explain:"å¸¸è¦‹åºåˆ—å¯†ç¢¼éå¸¸å®¹æ˜“è¢«ç ´è§£ã€‚"
      }
    ];

    // äº‹ä»¶æ¨¡æ¿ï¼šä¾å®‰å…¨/å¿ƒæƒ…/ä½æˆ¿/å·¥ä½œè§¸ç™¼
    function buildEventPool(){
      return [
        {
          id:"evt_scam_sms",
          title:"è©é¨™ç°¡è¨Šï¼šåŒ…è£¹æœªå–",
          level:"warn",
          condition:(s)=> true,
          intro:"ä½ æ”¶åˆ°ã€åŒ…è£¹æœªå–ï¼Œè«‹é»é€£çµè£œè³‡æ–™ã€ç°¡è¨Šã€‚",
          options:[
            {
              label:"ä¸é»é€£çµï¼Œæ”¹ç”¨å®˜æ–¹APPæŸ¥è©¢ï¼ˆæ¶ˆè€—1è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:1 },
              apply:(s)=> ({...s, security: clamp(s.security+3,0,100), mood: clamp(s.mood+1,0,100)}),
              log:"ä½ æ”¹ç”¨å®˜æ–¹ç®¡é“æŸ¥è©¢ï¼Œé¿é–‹é‡£é­šé€£çµã€‚"
            },
            {
              label:"é»é€£çµå¡«è³‡æ–™ï¼ˆä¸æ¶ˆè€—è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:0 },
              apply:(s)=> {
                const hit = Math.random() < clamp(0.55 - s.security/200, 0.15, 0.55);
                if(hit){
                  return {...s, money: Math.max(0, s.money-800), security: clamp(s.security-6,0,100), mood: clamp(s.mood-6,0,100)};
                }
                return {...s, security: clamp(s.security-2,0,100), mood: clamp(s.mood-2,0,100)};
              },
              log:"ä½ é»äº†ä¸æ˜é€£çµâ€¦å¯èƒ½é€ æˆå€‹è³‡/é‡‘éŒ¢æå¤±ã€‚"
            },
          ],
        },
        {
          id:"evt_roommate",
          title:"å®¤å‹æƒ…ç·’è¡çª",
          level:"info",
          condition:(s)=> s.housingId === "room_shared",
          intro:"å®¤å‹æŠ±æ€¨ä½ å¤ªæ™šå›å®¶ï¼Œæ°£æ°›ç·Šå¼µã€‚",
          options:[
            {
              label:"å…ˆå”å•†è¦å‰‡èˆ‡ç•Œç·šï¼ˆæ¶ˆè€—1è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:1 },
              apply:(s)=> ({...s, mood: clamp(s.mood+4,0,100), security: clamp(s.security+1,0,100)}),
              log:"ä½ å˜—è©¦å”å•†ï¼Œè¡çªé™æº«ã€‚"
            },
            {
              label:"ä¸ç†æœƒï¼ˆä¸æ¶ˆè€—è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:0 },
              apply:(s)=> ({...s, mood: clamp(s.mood-8,0,100), health: clamp(s.health-2,0,100)}),
              log:"ä½ é¸æ“‡ä¸è™•ç†ï¼Œå£“åŠ›ç´¯ç©ã€‚"
            },
          ],
        },
        {
          id:"evt_overtime",
          title:"è‡¨æ™‚åŠ ç­",
          level:"info",
          condition:(s)=> s.jobId && s.jobId !== "unemployed",
          intro:"ä¸»ç®¡è‡¨æ™‚åŠ ç­ï¼Œæ™‚é–“è¢«å£“ç¸®ã€‚",
          options:[
            {
              label:"åŠ ç­ï¼ˆæ”¶å…¥+300ï¼å¿ƒæƒ…-3ï¼é«”åŠ›-2ï¼‰ï¼ˆæ¶ˆè€—1è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:1 },
              apply:(s)=> ({...s, money: s.money+300, mood: clamp(s.mood-3,0,100), health: clamp(s.health-2,0,100)}),
              log:"ä½ é¸æ“‡åŠ ç­ï¼Œå¢åŠ ä¸€äº›æ”¶å…¥ã€‚"
            },
            {
              label:"å©‰æ‹’ï¼Œä¿ç•™ä¼‘æ¯ï¼ˆå¿ƒæƒ…+1ï¼‰ï¼ˆæ¶ˆè€—1è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:1 },
              apply:(s)=> ({...s, mood: clamp(s.mood+1,0,100), security: clamp(s.security+1,0,100)}),
              log:"ä½ å©‰æ‹’åŠ ç­ï¼Œä¿ä½ä¼‘æ¯èˆ‡ç•Œç·šã€‚"
            },
          ],
        },
        {
          id:"evt_sick",
          title:"èº«é«”ä¸èˆ’æœ",
          level:"warn",
          condition:(s)=> s.health <= 70 || Math.random() < 0.35,
          intro:"ä½ é–‹å§‹å’³å—½ã€é ­ç—›ï¼Œå½±éŸ¿ç‹€æ…‹ã€‚",
          options:[
            {
              label:"è²·è—¥ä¼‘æ¯ï¼ˆèŠ±è²»200ï¼é«”åŠ›+6ï¼‰ï¼ˆæ¶ˆè€—1è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:1, money:200 },
              apply:(s)=> ({...s, money: Math.max(0, s.money-200), health: clamp(s.health+6,0,100), mood: clamp(s.mood+1,0,100)}),
              log:"ä½ å®‰æ’ä¼‘æ¯èˆ‡ç…§é¡§èº«é«”ã€‚"
            },
            {
              label:"ç¡¬æ’ï¼ˆé«”åŠ›-6ï¼å¿ƒæƒ…-3ï¼‰ï¼ˆä¸æ¶ˆè€—è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:0 },
              apply:(s)=> ({...s, health: clamp(s.health-6,0,100), mood: clamp(s.mood-3,0,100)}),
              log:"ä½ é¸æ“‡ç¡¬æ’ï¼Œç–²å‹ç´¯ç©ã€‚"
            },
          ],
        },
        {
          id:"evt_shady_invite",
          title:"é™Œç”Ÿäººé‚€ä½ ã€ä»£æ”¶æ¬¾æŠ½æˆã€",
          level:"bad",
          condition:(s)=> true,
          intro:"æœ‰äººç§è¨Šä½ ï¼šã€ä»£æ”¶æ¬¾å°±æŠ½æˆï¼Œè¼•é¬†è³ºã€‚ã€",
          options:[
            {
              label:"ç›´æ¥æ‹’çµ•ï¼‹å°é–ï¼ˆè³‡å®‰+4ï¼‰ï¼ˆæ¶ˆè€—1è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:1 },
              apply:(s)=> ({...s, security: clamp(s.security+4,0,100), mood: clamp(s.mood+1,0,100)}),
              log:"ä½ æ‹’çµ•ä¸¦å°é–ï¼Œé™ä½å¾ŒçºŒé¢¨éšªã€‚"
            },
            {
              label:"è©¦ä¸€æ¬¡ï¼ˆæ”¶å…¥+1200ï¼›è‹¥ä¸­æ‹›ï¼šè³‡å®‰-12ã€é‡‘éŒ¢-1000ï¼‰ï¼ˆä¸æ¶ˆè€—è¡Œå‹•åŠ›ï¼‰",
              cost:{ ap:0 },
              apply:(s)=> {
                const hit = Math.random() < clamp(0.60 - s.security/220, 0.18, 0.60);
                if(hit){
                  return {...s, money: Math.max(0, s.money-1000), security: clamp(s.security-12,0,100), mood: clamp(s.mood-10,0,100)};
                }
                return {...s, money: s.money+1200, security: clamp(s.security-6,0,100), mood: clamp(s.mood-3,0,100)};
              },
              log:"ä½ æŠŠè‡ªå·±æ”¾é€²é«˜é¢¨éšªæƒ…å¢ƒâ€¦"
            },
          ],
        }
      ];
    }

    // -------------------------
    // Initial State
    // -------------------------
    const INITIAL = {
      version:"1.0",
      phase:"onboarding", // onboarding | home
      spinning:false,
      spinResult:null,
      modal:null,

      // Stats
      week:1,
      maxWeeks:10,
      age:18,
      ap:3,
      maxAp:3,

      money:0,
      savings:0,
      health:100,
      mood:100,
      security:50,

      // selections
      originGrade:null,
      originDesc:"",
      phoneSecurityChoice:null, // weak | 2fa

      housingId:null,
      jobId:"unemployed",

      // finance plan
      planWeeklySave: 0,      // planned transfer to savings at week end
      planWeeklyBudget: 0,    // for user reference only
      streakQuiz: 0,

      // inventory
      inventory: {},

      // events
      activeEvent:null,       // {id,title, intro, options, level}
      resolvedEvents:0,

      // logs
      logs:[
        `> ç³»çµ±åˆå§‹åŒ–å®Œæˆ...`,
      ],

      // last saved
      lastSavedAt: 0,
    };

    // -------------------------
    // Game Engine (pure-ish)
    // -------------------------
    function addLog(state, msg){
      const logs = [`> ${msg}`, ...state.logs].slice(0, 14);
      return {...state, logs};
    }

    function canAfford(state, cost){
      if(!cost) return true;
      const moneyNeed = cost.money || 0;
      const apNeed = cost.ap || 0;
      return state.money >= moneyNeed && state.ap >= apNeed;
    }

    function applyCost(state, cost){
      if(!cost) return state;
      let s = {...state};
      if(cost.money) s.money = Math.max(0, s.money - cost.money);
      if(cost.ap) s.ap = Math.max(0, s.ap - cost.ap);
      return s;
    }

    function addInventory(state, itemId){
      const inv = {...state.inventory};
      inv[itemId] = (inv[itemId] || 0) + 1;
      return {...state, inventory: inv};
    }

    function useInventoryIfHas(state, itemId){
      const inv = {...state.inventory};
      if((inv[itemId]||0) <= 0) return { state, used:false };
      inv[itemId] = inv[itemId] - 1;
      return { state: {...state, inventory: inv}, used:true };
    }

    function pickWeeklyEvent(state){
      const pool = buildEventPool().filter(e => e.condition(state));
      // å¢åŠ é¢¨éšªæ¬Šé‡ï¼šå®‰å…¨ä½æ™‚åå‘ bad/warn
      const weighted = [];
      for(const e of pool){
        let w = 1;
        if(e.level === "bad") w += clamp((60 - state.security)/12, 0, 4);
        if(e.level === "warn") w += clamp((55 - state.security)/18, 0, 2);
        if(e.level === "info") w += 1;
        for(let i=0;i<Math.round(w*10);i++) weighted.push(e);
      }
      return pick(weighted);
    }

    function weekUpkeep(state){
      // åŸºæœ¬ç”Ÿæ´»æˆæœ¬ï¼šè‹¥æœ‰ä½æˆ¿ï¼Œä»˜æˆ¿ç§Ÿï¼›ç„¡ä½æˆ¿æœƒé€ æˆèº«å¿ƒæè€—
      let s = {...state};

      // æ”¶å…¥ï¼ˆè‹¥æœ‰å·¥ä½œï¼‰
      const job = JOB_OPTIONS.find(j => j.id === s.jobId) || JOB_OPTIONS.find(j => j.id==="unemployed");
      if(job && job.weeklyPay){
        s.money += job.weeklyPay;
        s = addLog(s, `æœ¬é€±å·¥ä½œæ”¶å…¥ +$${job.weeklyPay}ï¼ˆ${job.name}ï¼‰`);
      }

      // æˆ¿ç§Ÿ
      const housing = HOUSING_OPTIONS.find(h => h.id === s.housingId);
      if(housing && housing.rent > 0){
        const rent = housing.rent;
        s.money = Math.max(0, s.money - rent);
        s = addLog(s, `æœ¬é€±æˆ¿ç§Ÿ -$${rent}ï¼ˆ${housing.name}ï¼‰`);
      } else if(s.housingId === "no_home" || !s.housingId){
        s.mood = clamp(s.mood - 8, 0, 100);
        s.health = clamp(s.health - 6, 0, 100);
        s = addLog(s, `å±…ä½ä¸ç©©å®šï¼šå¿ƒæƒ… -8ï¼é«”åŠ› -6`);
      }

      // é€±åŸºæœ¬é–‹éŠ·ï¼ˆäº¤é€š/é¤è²»ç­‰ï¼‰
      const base = 900;
      s.money = Math.max(0, s.money - base);
      s = addLog(s, `ç”Ÿæ´»é–‹éŠ· -$${base}`);

      // ä¾å·¥ä½œè² è·èª¿æ•´
      if(job){
        s.mood = clamp(s.mood + (job.mood||0), 0, 100);
        s.health = clamp(s.health + (job.health||0), 0, 100);
        s.security = clamp(s.security + (job.security||0), 0, 100);
      }

      // ä¾ä½æˆ¿èª¿æ•´
      if(housing){
        s.mood = clamp(s.mood + (housing.mood||0), 0, 100);
        s.security = clamp(s.security + (housing.safety||0), 0, 100);
      }

      // é¤åˆ¸åŠ æˆï¼ˆè‹¥æœ‰ï¼‰
      const usedMeal = useInventoryIfHas(s, "meal");
      s = usedMeal.state;
      if(usedMeal.used){
        s.health = clamp(s.health + 3, 0, 100);
        s.mood = clamp(s.mood + 2, 0, 100);
        s = addLog(s, `ä½¿ç”¨é¤åˆ¸ï¼šé«”åŠ› +3ï¼å¿ƒæƒ… +2`);
      }

      // è¨ˆç•«æ€§å„²è“„ï¼šæŠŠè¨ˆç•«é‡‘é¡è½‰å…¥savingsï¼ˆè‹¥å¤ éŒ¢ï¼‰
      const plan = Math.max(0, s.planWeeklySave|0);
      if(plan > 0){
        const amt = Math.min(plan, s.money);
        s.money -= amt;
        s.savings += amt;
        s = addLog(s, `è‡ªå‹•å„²è“„ +$${amt}ï¼ˆå­˜å…¥å„²è“„ï¼‰`);
      }

      // AP reset + week++
      s.week += 1;
      s.ap = s.maxAp;

      // ç”Ÿæˆæ–°äº‹ä»¶ï¼ˆå¦‚æœé‚„æ²’çµæŸï¼‰
      if(s.week <= s.maxWeeks){
        const evt = pickWeeklyEvent(s);
        s.activeEvent = {
          id: evt.id,
          title: evt.title,
          level: evt.level,
          intro: evt.intro,
          options: evt.options
        };
        s = addLog(s, `æœ¬é€±äº‹ä»¶ï¼š${evt.title}`);
      }

      return s;
    }

    function checkGameOver(state){
      if(state.week > state.maxWeeks) return { over:true, reason:"å®Œæˆæ‰€æœ‰é€±æ¬¡" };
      if(state.health <= 0) return { over:true, reason:"é«”åŠ›æ­¸é›¶ï¼šéœ€è¦å…ˆæ¢å¾©èº«å¿ƒå®‰å…¨" };
      if(state.mood <= 0) return { over:true, reason:"å¿ƒæƒ…æ­¸é›¶ï¼šéœ€è¦å…ˆç©©å®šæƒ…ç·’èˆ‡æ”¯æŒ" };
      if(state.security <= 0) return { over:true, reason:"è³‡å®‰æ­¸é›¶ï¼šé«˜é¢¨éšªç‹€æ…‹" };
      return { over:false, reason:"" };
    }

    function finalScore(state){
      // ç°¡å–®ç¸½è©•ï¼šå­˜æ¬¾èˆ‡èº«å¿ƒ/è³‡å®‰
      const wealth = state.money + state.savings;
      const stability = Math.round((state.health + state.mood + state.security) / 3);
      let grade = "C";
      if(wealth >= 18000 && stability >= 75) grade = "A";
      else if(wealth >= 12000 && stability >= 65) grade = "B";
      else if(wealth >= 7000 && stability >= 55) grade = "C";
      else if(wealth >= 3000 && stability >= 45) grade = "D";
      else grade = "E";
      return { wealth, stability, grade };
    }

    // -------------------------
    // UI Helpers
    // -------------------------
    function StatChip({label, value, kind}){
      return <span className={"chip " + (kind||"")}>{label}ï¼š{value}</span>;
    }

    // -------------------------
    // App
    // -------------------------
    function App(){
      const [S, setS] = useState(()=> {
        const saved = loadSave();
        if(saved && saved.state){
          return {...INITIAL, ...saved.state, modal:null, spinning:false};
        }
        return {...INITIAL};
      });

      // Autosave
      useEffect(()=>{
        const payload = { version:"1.0", savedAt: nowTs(), state: {...S, modal:null, spinning:false} };
        saveGame(payload);
      }, [S.week, S.money, S.savings, S.health, S.mood, S.security, S.ap, S.housingId, S.jobId, S.planWeeklySave, S.planWeeklyBudget, JSON.stringify(S.inventory), S.phase]);

      const gameOver = useMemo(()=> checkGameOver(S), [S]);
      const score = useMemo(()=> finalScore(S), [S]);

      const add = (msg)=> setS(prev => addLog(prev, msg));

      const openModal = (modal)=> setS(prev => ({...prev, modal}));
      const closeModal = ()=> setS(prev => ({...prev, modal:null}));

      const spendAPGuard = (cost, onOk) => {
        setS(prev=>{
          if(!canAfford(prev, cost)){
            return addLog(prev, "è¡Œå‹•åŠ›æˆ–é‡‘éŒ¢ä¸è¶³ï¼Œç„¡æ³•åŸ·è¡Œã€‚");
          }
          const after = applyCost(prev, cost);
          return onOk(after);
        });
      };

      // -------------------------
      // Onboarding
      // -------------------------
      const spin = ()=>{
        if(S.spinning) return;
        setS(prev => addLog({...prev, spinning:true}, "å‘½é‹è½‰ç›¤å•Ÿå‹•..."));
        setTimeout(()=>{
          const origin = pickOrigin();
          const age = rint(15,19);
          setS(prev=>{
            let n = {...prev};
            n.spinning = false;
            n.spinResult = { ...origin, age };
            n.originGrade = origin.grade;
            n.originDesc = origin.desc;
            n.age = age;
            n.money = origin.money;
            n = addLog(n, `æŠ½åˆ°ç­‰ç´š ${origin.grade}ï¼åˆå§‹å­˜æ¬¾ $${origin.money}ï¼å¹´é½¡ ${age}`);
            return n;
          });
        }, 1100);
      };

      const choosePassword = ()=>{
        openModal({
          title:"ç¬¬ä¸€é—œï¼šè¨­å®šæ‰‹æ©Ÿå¯†ç¢¼",
          body:"é¸æ“‡ä½ çš„è³‡å®‰ç­–ç•¥ï¼ˆæœƒå½±éŸ¿å¾ŒçºŒè©é¨™é¢¨éšªï¼‰ã€‚",
          options:[
            {
              label:"1) 123456ï¼ˆæ–¹ä¾¿å¥½è¨˜ï¼‰ â†’ è³‡å®‰ -20",
              action: ()=>{
                setS(prev=>{
                  let n = {...prev};
                  n.security = clamp(n.security-20, 0, 100);
                  n.phoneSecurityChoice = "weak";
                  n = addLog(n, "é¸æ“‡å¼±å¯†ç¢¼ï¼šè³‡å®‰ -20");
                  n.phase = "home";
                  // èµ·å§‹äº‹ä»¶
                  const evt = pickWeeklyEvent(n);
                  n.activeEvent = { id:evt.id, title:evt.title, level:evt.level, intro:evt.intro, options:evt.options };
                  n = addLog(n, `æœ¬é€±äº‹ä»¶ï¼š${evt.title}`);
                  n.modal = null;
                  return n;
                });
              }
            },
            {
              label:"2) é–‹å•Ÿ 2FAï¼ˆå®‰å…¨é©—è­‰ï¼‰ â†’ è³‡å®‰ +10",
              action: ()=>{
                setS(prev=>{
                  let n = {...prev};
                  n.security = clamp(n.security+10, 0, 100);
                  n.phoneSecurityChoice = "2fa";
                  n = addLog(n, "é–‹å•Ÿ 2FAï¼šè³‡å®‰ +10");
                  n.phase = "home";
                  const evt = pickWeeklyEvent(n);
                  n.activeEvent = { id:evt.id, title:evt.title, level:evt.level, intro:evt.intro, options:evt.options };
                  n = addLog(n, `æœ¬é€±äº‹ä»¶ï¼š${evt.title}`);
                  n.modal = null;
                  return n;
                });
              }
            }
          ]
        });
      };

      const restart = ()=>{
        clearSave();
        window.location.reload();
      };

      // -------------------------
      // Home Actions
      // -------------------------
      const openHousing = ()=>{
        const housing = HOUSING_OPTIONS.find(h => h.id === S.housingId);
        openModal({
          title:"ğŸ  ç§Ÿå±‹ä¸­å¿ƒ",
          body:"é¸æ“‡ä½ æœ¬é€±çš„å±…ä½å‹æ…‹ï¼ˆéƒ¨åˆ†é¸é …éœ€å…ˆä»˜æŠ¼é‡‘ï¼‰ã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">ç›®å‰å±…ä½</div><div className="v">{housing ? housing.name : "æœªé¸æ“‡"}</div></div>
                <div className="kv"><div className="k">æœ¬é€±è¡Œå‹•åŠ›</div><div className="v">{S.ap}/{S.maxAp}</div></div>
              </div>
              <div className="hr"></div>
              {HOUSING_OPTIONS.map(h=>{
                const isCurrent = h.id === S.housingId;
                const needDeposit = (S.housingId !== h.id) && h.deposit > 0 && !isCurrent;
                const disabled = needDeposit && S.money < h.deposit;
                return (
                  <button key={h.id} className="opt" disabled={disabled}
                    onClick={()=>{
                      // æ›´æ›ä½æˆ¿ï¼šæ¶ˆè€—1APï¼›è‹¥éœ€æŠ¼é‡‘å°±å…ˆä»˜æŠ¼é‡‘ï¼›æœ¬é€±èµ·ç®—æˆ¿ç§Ÿåœ¨é€±çµç®—
                      const cost = { ap:1, money: (needDeposit ? h.deposit : 0) };
                      spendAPGuard(cost, (after)=>{
                        let n = {...after};
                        n.housingId = h.id;
                        n.security = clamp(n.security + (h.safety||0), 0, 100);
                        n.mood = clamp(n.mood + (h.mood||0), 0, 100);
                        n = addLog(n, `ä½æˆ¿èª¿æ•´ï¼š${h.name}${needDeposit?`ï¼ˆæŠ¼é‡‘ -$${h.deposit}ï¼‰`:""}`);
                        n.modal = null;
                        return n;
                      });
                    }}
                  >
                    <div style={{display:"flex", justifyContent:"space-between", gap:10}}>
                      <div style={{minWidth:0}}>
                        <div style={{fontWeight:900}}>{h.name} {isCurrent && <span className="badge gray">ç›®å‰</span>}</div>
                        <div className="hint">æˆ¿ç§Ÿï¼š${h.rent}/é€±ï½œæŠ¼é‡‘ï¼š${h.deposit}ï½œ{h.note}</div>
                      </div>
                      <div style={{textAlign:"right", whiteSpace:"nowrap"}}>
                        <div className="badge info">å®‰å…¨ {h.safety>=0?`+${h.safety}`:h.safety}</div>
                        <div style={{height:6}}></div>
                        <div className="badge vio">å¿ƒæƒ… {h.mood>=0?`+${h.mood}`:h.mood}</div>
                      </div>
                    </div>
                  </button>
                );
              })}
              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const openJob = ()=>{
        const job = JOB_OPTIONS.find(j => j.id === S.jobId) || JOB_OPTIONS.find(j=>j.id==="unemployed");
        openModal({
          title:"ğŸ’¼ äººåŠ›éŠ€è¡Œ",
          body:"é¸æ“‡ä½ çš„å·¥ä½œï¼ˆå·¥ä½œæœƒåœ¨é€±çµç®—æ™‚ç™¼è–ªï¼Œä¸¦å½±éŸ¿èº«å¿ƒ/è³‡å®‰ï¼‰ã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">ç›®å‰å·¥ä½œ</div><div className="v">{job.name}</div></div>
                <div className="kv"><div className="k">æœ¬é€±è¡Œå‹•åŠ›</div><div className="v">{S.ap}/{S.maxAp}</div></div>
              </div>
              <div className="hr"></div>
              {JOB_OPTIONS.map(j=>{
                const isCurrent = j.id === S.jobId;
                const risk = (j.scamRisk||0);
                return (
                  <button key={j.id} className="opt"
                    onClick={()=>{
                      spendAPGuard({ap:1}, (after)=>{
                        let n = {...after};
                        n.jobId = j.id;
                        n = addLog(n, `å·¥ä½œé¸æ“‡ï¼š${j.name}ï¼ˆé€±è–ª $${j.weeklyPay}ï¼‰`);
                        if(risk>0){
                          n.security = clamp(n.security - Math.round(risk/5), 0, 100);
                          n = addLog(n, `é«˜é¢¨éšªå·¥ä½œè­¦ç¤ºï¼šè³‡å®‰ä¸‹é™ï¼ˆé¢¨éšª ${risk}ï¼‰`);
                        }
                        n.modal = null;
                        return n;
                      });
                    }}
                  >
                    <div style={{display:"flex", justifyContent:"space-between", gap:10}}>
                      <div style={{minWidth:0}}>
                        <div style={{fontWeight:900}}>{j.name} {isCurrent && <span className="badge gray">ç›®å‰</span>}</div>
                        <div className="hint">é€±è–ªï¼š${j.weeklyPay}ï½œ{j.note}</div>
                      </div>
                      <div style={{textAlign:"right", whiteSpace:"nowrap"}}>
                        <div className={"badge " + (j.weeklyPay>=1600?"ok":"info")}>æ”¶å…¥ {j.weeklyPay}</div>
                        <div style={{height:6}}></div>
                        <div className={"badge " + (risk>0?"bad":"gray")}>é¢¨éšª {risk||0}</div>
                      </div>
                    </div>
                  </button>
                );
              })}
              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const openResource = ()=>{
        openModal({
          title:"ğŸ—ºï¸ è³‡æºåœ°åœ–",
          body:"ä½¿ç”¨è³‡æºæ¢å¾©èº«å¿ƒæˆ–æå‡å®‰å…¨ï¼ˆå¤šæ•¸éœ€è¦è¡Œå‹•åŠ›ï¼‰ã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">æœ¬é€±è¡Œå‹•åŠ›</div><div className="v">{S.ap}/{S.maxAp}</div></div>
                <div className="kv"><div className="k">ç›®å‰ç‹€æ…‹</div><div className="v">{Math.round((S.health+S.mood+S.security)/3)}</div></div>
              </div>
              <div className="hr"></div>

              <button className="opt"
                onClick={()=>{
                  spendAPGuard({ap:1}, (after)=>{
                    let n = {...after};
                    n.mood = clamp(n.mood+8,0,100);
                    n.security = clamp(n.security+2,0,100);
                    n = addLog(n, "ä½¿ç”¨è³‡æºï¼šå¿ƒç†æ”¯æŒï¼æƒ…ç·’é™ªä¼´ï¼ˆå¿ƒæƒ… +8ï¼è³‡å®‰ +2ï¼‰");
                    n.modal = null;
                    return n;
                  });
                }}
              >
                å¿ƒç†æ”¯æŒï¼æƒ…ç·’é™ªä¼´ï¼ˆAP-1ï¼‰ <span className="badge ok">å¿ƒæƒ… +8</span>
              </button>

              <button className="opt"
                onClick={()=>{
                  spendAPGuard({ap:1}, (after)=>{
                    let n = {...after};
                    n.health = clamp(n.health+10,0,100);
                    n = addLog(n, "ä½¿ç”¨è³‡æºï¼šå°±é†«/å¥åº·ç…§è­·ï¼ˆé«”åŠ› +10ï¼‰");
                    n.modal = null;
                    return n;
                  });
                }}
              >
                å¥åº·ç…§è­·ï¼å°±é†«å”åŠ©ï¼ˆAP-1ï¼‰ <span className="badge ok">é«”åŠ› +10</span>
              </button>

              <button className="opt"
                onClick={()=>{
                  spendAPGuard({ap:1}, (after)=>{
                    let n = {...after};
                    n.security = clamp(n.security+10,0,100);
                    n = addLog(n, "ä½¿ç”¨è³‡æºï¼šæ³•å¾‹/é˜²è©è«®è©¢ï¼ˆè³‡å®‰ +10ï¼‰");
                    n.modal = null;
                    return n;
                  });
                }}
              >
                æ³•å¾‹/é˜²è©è«®è©¢ï¼ˆAP-1ï¼‰ <span className="badge info">è³‡å®‰ +10</span>
              </button>

              <button className="opt"
                onClick={()=>{
                  spendAPGuard({ap:1}, (after)=>{
                    let n = {...after};
                    n.money += 600;
                    n.mood = clamp(n.mood+2,0,100);
                    n = addLog(n, "ä½¿ç”¨è³‡æºï¼šæ€¥é›£è£œåŠ©è©•ä¼°ï¼ˆ+600ï¼å¿ƒæƒ… +2ï¼‰");
                    n.modal = null;
                    return n;
                  });
                }}
              >
                æ€¥é›£è£œåŠ©è©•ä¼°ï¼ˆAP-1ï¼‰ <span className="badge info">é‡‘éŒ¢ +600</span>
              </button>

              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const openFinance = ()=>{
        openModal({
          title:"ğŸ’³ è²¡å‹™ç®¡å®¶",
          body:"è¨­å®šé ç®—/å„²è“„ã€åšé˜²è©èˆ‡ç†è²¡æ¸¬é©—ã€æŸ¥çœ‹è³‡ç”¢ã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">å¯ç”¨é¤˜é¡</div><div className="v">${S.money}</div></div>
                <div className="kv"><div className="k">å„²è“„</div><div className="v">${S.savings}</div></div>
              </div>
              <div className="hr"></div>

              <div className="card" style={{boxShadow:"var(--shadow-sm)"}}>
                <div style={{fontWeight:900}}>æ¯é€±è¨ˆç•«</div>
                <div className="hint">æ­¤è™•ä¸æ‰£è¡Œå‹•åŠ›ï¼›é€±çµç®—æœƒä¾è¨ˆç•«è‡ªå‹•å­˜å…¥ï¼ˆè‹¥é¤˜é¡è¶³å¤ ï¼‰ã€‚</div>

                <div style={{display:"flex", gap:10, marginTop:10}}>
                  <div style={{flex:1}}>
                    <div className="label">æ¯é€±é ç®—ï¼ˆåƒè€ƒç”¨ï¼‰</div>
                    <input id="budget" type="number" min="0" value={S.planWeeklyBudget}
                      style={{width:"100%", padding:"10px", border:"var(--border)", borderRadius:"12px", fontWeight:900}}
                      onChange={(e)=> setS(prev=>({...prev, planWeeklyBudget: Math.max(0, parseInt(e.target.value||"0",10))}))}
                    />
                  </div>
                  <div style={{flex:1}}>
                    <div className="label">æ¯é€±å„²è“„ï¼ˆè‡ªå‹•è½‰å…¥ï¼‰</div>
                    <input id="save" type="number" min="0" value={S.planWeeklySave}
                      style={{width:"100%", padding:"10px", border:"var(--border)", borderRadius:"12px", fontWeight:900}}
                      onChange={(e)=> setS(prev=>({...prev, planWeeklySave: Math.max(0, parseInt(e.target.value||"0",10))}))}
                    />
                  </div>
                </div>

                <div className="chiprow">
                  <StatChip label="æœ¬é€±è¡Œå‹•åŠ›" value={`${S.ap}/${S.maxAp}`} kind="info"/>
                  <StatChip label="é€£çºŒæ¸¬é©—" value={`${S.streakQuiz}`} kind="vio"/>
                  {S.inventory["notebook"] ? <StatChip label="è¨˜å¸³æœ¬" value={`x${S.inventory["notebook"]}`} kind="ok"/> : null}
                </div>
              </div>

              <button className="opt"
                onClick={()=> openQuiz()}
              >
                ğŸ“ é˜²è©/ç†è²¡æ¸¬é©—ï¼ˆAP-1ï¼‰ <span className="badge info">ç­”å°åŠ åˆ†</span>
              </button>

              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const openShop = ()=>{
        openModal({
          title:"ğŸ›’ å•†åº—",
          body:"ç”¨é‡‘éŒ¢è³¼è²·é“å…·ï¼Œæå‡èº«å¿ƒ/è³‡å®‰ï¼ˆè³¼è²·ä¸æ‰£è¡Œå‹•åŠ›ï¼‰ã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">å¯ç”¨é¤˜é¡</div><div className="v">${S.money}</div></div>
                <div className="kv"><div className="k">ç‰©å“æ•¸é‡</div><div className="v">{Object.values(S.inventory).reduce((a,b)=>a+b,0)}</div></div>
              </div>
              <div className="hr"></div>

              {SHOP_ITEMS.map(it=>{
                const owned = S.inventory[it.id] || 0;
                const eff = Object.entries(it.effects).map(([k,v])=>{
                  const label = k==="mood" ? "å¿ƒæƒ…" : k==="health" ? "é«”åŠ›" : k==="security" ? "è³‡å®‰" : k;
                  return `${label} ${v>0?`+${v}`:v}`;
                }).join("ï¼");
                return (
                  <button key={it.id} className="opt" disabled={S.money < it.price}
                    onClick={()=>{
                      setS(prev=>{
                        if(prev.money < it.price) return addLog(prev, "é‡‘éŒ¢ä¸è¶³ï¼Œç„¡æ³•è³¼è²·ã€‚");
                        let n = {...prev};
                        n.money -= it.price;
                        n = addInventory(n, it.id);
                        // å³æ™‚æ•ˆæœï¼šç›´æ¥åŠ åˆ†ï¼ˆé¤åˆ¸/æ¶ˆè€—å“å¦è¨ˆï¼‰
                        const ef = it.effects || {};
                        if(ef.mood) n.mood = clamp(n.mood + ef.mood, 0, 100);
                        if(ef.health) n.health = clamp(n.health + ef.health, 0, 100);
                        if(ef.security) n.security = clamp(n.security + ef.security, 0, 100);
                        n = addLog(n, `è³¼è²·ï¼š${it.name} -$${it.price}ï¼ˆ${eff}ï¼‰`);
                        return n;
                      });
                    }}
                  >
                    <div style={{display:"flex", justifyContent:"space-between", gap:10}}>
                      <div style={{minWidth:0}}>
                        <div style={{fontWeight:900}}>{it.name} <span className="badge gray">x{owned}</span></div>
                        <div className="hint">åƒ¹æ ¼ï¼š${it.price}ï½œ{it.note}</div>
                      </div>
                      <div style={{textAlign:"right"}}>
                        <div className="badge ok">{eff}</div>
                      </div>
                    </div>
                  </button>
                );
              })}

              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const openEvent = ()=>{
        if(!S.activeEvent){
          add("æœ¬é€±ç›®å‰æ²’æœ‰äº‹ä»¶ã€‚");
          return;
        }
        const evt = S.activeEvent;
        openModal({
          title:`ğŸ“Œ äº‹ä»¶ï¼š${evt.title}`,
          body: evt.intro,
          render: ()=>(
            <div>
              <div className="chiprow">
                <StatChip label="æœ¬é€±è¡Œå‹•åŠ›" value={`${S.ap}/${S.maxAp}`} kind="info"/>
                <StatChip label="è³‡å®‰" value={`${S.security}`} kind={S.security>=60?"ok":S.security>=40?"info":"bad"}/>
                <StatChip label="å¿ƒæƒ…" value={`${S.mood}`} kind={S.mood>=60?"ok":S.mood>=40?"info":"bad"}/>
                <StatChip label="é«”åŠ›" value={`${S.health}`} kind={S.health>=60?"ok":S.health>=40?"info":"bad"}/>
              </div>

              {evt.options.map((op, idx)=>{
                const needAp = op.cost?.ap || 0;
                const needMoney = op.cost?.money || 0;
                const disabled = !canAfford(S, op.cost);
                return (
                  <button key={idx} className="opt" disabled={disabled}
                    onClick={()=>{
                      spendAPGuard(op.cost || {}, (after)=>{
                        let n = {...after};
                        // ç‰©å“æ¸›å‚·ï¼šæ€¥æ•‘åŒ…å¯æ¸›å°‘ç”Ÿç—…äº‹ä»¶çš„è² é¢ï¼ˆç°¡åŒ–ï¼šè‹¥é¸åˆ°æœƒæ‰£healthçš„é¸é …ï¼Œä¸”æŒæœ‰æ€¥æ•‘åŒ…å°±é¡å¤–+3 healthï¼‰
                        const before = n;
                        n = op.apply(n);

                        // å¦‚æœé¸é …å¾Œ health æ‰ï¼Œä¸”æœ‰æ€¥æ•‘åŒ…å°±è£œä¸€äº›ï¼ˆæ¶ˆè€—1å€‹ï¼‰
                        const diffHealth = n.health - before.health;
                        if(diffHealth < 0){
                          const used = useInventoryIfHas(n, "firstaid");
                          n = used.state;
                          if(used.used){
                            n.health = clamp(n.health + 3, 0, 100);
                            n = addLog(n, "ä½¿ç”¨æ€¥æ•‘åŒ…ï¼šé¡å¤–é«”åŠ› +3");
                          }
                        }

                        n = addLog(n, op.log);
                        n.activeEvent = null;
                        n.resolvedEvents += 1;
                        n.modal = null;
                        return n;
                      });
                    }}
                  >
                    {op.label}
                    {(needAp>0 || needMoney>0) && (
                      <div className="hint">
                        æˆæœ¬ï¼š{needAp>0?`AP-${needAp}`:""}{needAp>0 && needMoney>0?"ï¼":""}{needMoney>0?`$-${needMoney}`:""}
                      </div>
                    )}
                  </button>
                );
              })}

              <button className="opt" onClick={closeModal}>ç¨å¾Œå†è™•ç†</button>
            </div>
          ),
          options:[]
        });
      };

      const openQuiz = ()=>{
        const q = pick(QUIZ_BANK);
        openModal({
          title:"ğŸ“ é˜²è©/ç†è²¡æ¸¬é©—",
          body:"ç­”é¡Œæœƒæ¶ˆè€—è¡Œå‹•åŠ› 1ï¼›ç­”å°æå‡è³‡å®‰èˆ‡å°é¡çå‹µã€‚",
          render: ()=>(
            <div>
              <div className="chiprow">
                <StatChip label="æœ¬é€±è¡Œå‹•åŠ›" value={`${S.ap}/${S.maxAp}`} kind="info"/>
                <StatChip label="é€£çºŒæ¸¬é©—" value={`${S.streakQuiz}`} kind="vio"/>
              </div>

              <div className="card" style={{boxShadow:"var(--shadow-sm)", marginTop:10}}>
                <div style={{fontWeight:900, fontSize:16}}>{q.q}</div>
                <div className="hint" style={{marginTop:6}}>é¸ä¸€å€‹ç­”æ¡ˆï¼š</div>
              </div>

              {q.options.map((o, idx)=>(
                <button key={idx} className="opt"
                  onClick={()=>{
                    spendAPGuard({ap:1}, (after)=>{
                      let n = {...after};
                      if(o.ok){
                        // åŸºç¤çå‹µ
                        let secGain = 6;
                        let moneyGain = 120;

                        // æœ‰è¨˜å¸³æœ¬åŠ æˆ
                        if((n.inventory["notebook"]||0) > 0){
                          secGain += 2;
                          moneyGain += 30;
                        }

                        n.security = clamp(n.security + secGain, 0, 100);
                        n.money += moneyGain;
                        n.mood = clamp(n.mood + 2, 0, 100);
                        n.streakQuiz = n.streakQuiz + 1;

                        n = addLog(n, `æ¸¬é©—ç­”å°ï¼šè³‡å®‰ +${secGain}ï¼é‡‘éŒ¢ +$${moneyGain}ï¼å¿ƒæƒ… +2`);
                        n = addLog(n, `è§£æï¼š${q.explain}`);
                      }else{
                        n.security = clamp(n.security - 4, 0, 100);
                        n.mood = clamp(n.mood - 3, 0, 100);
                        n.streakQuiz = 0;
                        n = addLog(n, "æ¸¬é©—ç­”éŒ¯ï¼šè³‡å®‰ -4ï¼å¿ƒæƒ… -3ï¼ˆé€£çºŒæ¸¬é©—æ­¸é›¶ï¼‰");
                        n = addLog(n, `è§£æï¼š${q.explain}`);
                      }
                      n.modal = null;
                      return n;
                    });
                  }}
                >
                  {o.t}
                </button>
              ))}

              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const endWeek = ()=>{
        setS(prev=>{
          let n = {...prev};

          // è‹¥æœ¬é€±äº‹ä»¶æ²’è™•ç†ï¼Œçµ¦ä¸€å€‹å°æƒ©ç½°ï¼ˆé¼“å‹µé¢å°äº‹ä»¶ï¼‰
          if(n.activeEvent){
            n.mood = clamp(n.mood - 4, 0, 100);
            n.security = clamp(n.security - 2, 0, 100);
            n = addLog(n, "æœªè™•ç†äº‹ä»¶ï¼šå¿ƒæƒ… -4ï¼è³‡å®‰ -2");
            n.activeEvent = null;
          }

          n = addLog(n, `--- é€±æ¬¡çµç®—ï¼šç¬¬ ${n.week} é€±çµæŸ ---`);
          n = weekUpkeep(n);

          const over = checkGameOver(n);
          if(over.over){
            n = addLog(n, `éŠæˆ²çµæŸï¼š${over.reason}`);
          }else{
            n = addLog(n, `ç¬¬ ${n.week} é€±é–‹å§‹ï¼šAP å·²é‡ç½®`);
          }
          return n;
        });
      };

      const openStatus = ()=>{
        const housing = HOUSING_OPTIONS.find(h=>h.id===S.housingId);
        const job = JOB_OPTIONS.find(j=>j.id===S.jobId) || JOB_OPTIONS.find(j=>j.id==="unemployed");
        openModal({
          title:"ğŸ“‹ èº«åˆ†ç¢ºèª",
          body:"æŸ¥çœ‹ç›®å‰è¨­å®šèˆ‡é¢¨éšªç‹€æ…‹ã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">å¹´é½¡</div><div className="v">{S.age}</div></div>
                <div className="kv"><div className="k">èµ·å§‹ç­‰ç´š</div><div className="v">{S.originGrade || "-"}</div></div>
              </div>

              <div className="hr"></div>

              <div className="card" style={{boxShadow:"var(--shadow-sm)"}}>
                <div style={{fontWeight:900}}>ç›®å‰é…ç½®</div>
                <div className="hint" style={{marginTop:6}}>
                  ä½æˆ¿ï¼š{housing ? housing.name : "æœªé¸æ“‡"}<br/>
                  å·¥ä½œï¼š{job.name}<br/>
                  æ‰‹æ©Ÿè³‡å®‰ï¼š{S.phoneSecurityChoice==="2fa" ? "å·²é–‹å•Ÿ2FA" : S.phoneSecurityChoice==="weak" ? "å¼±å¯†ç¢¼" : "æœªè¨­å®š"}<br/>
                  æ¯é€±å„²è“„ï¼š${S.planWeeklySave}ï¼ˆè‡ªå‹•ï¼‰ï¼æ¯é€±é ç®—ï¼š${S.planWeeklyBudget}
                </div>
              </div>

              <div className="card" style={{boxShadow:"var(--shadow-sm)"}}>
                <div style={{fontWeight:900}}>è³‡ç”¢èˆ‡ç‹€æ…‹</div>
                <div className="chiprow" style={{marginTop:8}}>
                  <StatChip label="å¯ç”¨" value={`$${S.money}`} kind="info"/>
                  <StatChip label="å„²è“„" value={`$${S.savings}`} kind="vio"/>
                  <StatChip label="è³‡å®‰" value={`${S.security}`} kind={S.security>=60?"ok":S.security>=40?"info":"bad"}/>
                  <StatChip label="å¿ƒæƒ…" value={`${S.mood}`} kind={S.mood>=60?"ok":S.mood>=40?"info":"bad"}/>
                  <StatChip label="é«”åŠ›" value={`${S.health}`} kind={S.health>=60?"ok":S.health>=40?"info":"bad"}/>
                </div>
              </div>

              <button className="opt" onClick={closeModal}>è¿”å›</button>
            </div>
          ),
          options:[]
        });
      };

      const openEnding = ()=>{
        openModal({
          title:"ğŸ çµç®—ç¸½è©•",
          body:"æœ¬å±€çµæŸï¼ŒæŸ¥çœ‹ä½ çš„æ•´é«”æˆæœã€‚",
          render: ()=>(
            <div>
              <div className="two">
                <div className="kv"><div className="k">ç¸½è³‡ç”¢</div><div className="v">${score.wealth}</div></div>
                <div className="kv"><div className="k">ç©©å®šåº¦</div><div className="v">{score.stability}</div></div>
              </div>
              <div className="hr"></div>
              <div className="card" style={{boxShadow:"var(--shadow-sm)"}}>
                <div style={{fontWeight:900}}>ç­‰ç´šè©•å®š</div>
                <div className="hint" style={{marginTop:6}}>
                  ä½ çš„è©•å®šï¼š<span className="badge info">Grade {score.grade}</span><br/>
                  å»ºè­°æ–¹å‘ï¼š<br/>
                  1) å…ˆç©©å®šå±…ä½èˆ‡æ”¶å…¥ï¼Œå†è«‡å„²è“„æ”¾å¤§ã€‚<br/>
                  2) è³‡å®‰æ˜¯åº•ç·šï¼šä¸é»é™Œç”Ÿé€£çµã€ä¸å€Ÿå¸³æˆ¶ã€ä¸å…ˆåŒ¯æ¬¾ã€‚<br/>
                  3) å¿ƒæƒ…èˆ‡é«”åŠ›æ˜¯çºŒèˆªï¼šæœ‰è³‡æºå°±ç”¨è³‡æºï¼Œä¸ç¡¬æ’ã€‚
                </div>
              </div>
              <button className="opt" onClick={restart}>é‡æ–°é–‹å§‹ï¼ˆæ¸…é™¤å­˜æª”ï¼‰</button>
              <button className="opt" onClick={closeModal}>é—œé–‰</button>
            </div>
          ),
          options:[]
        });
      };

      // -------------------------
      // Render
      // -------------------------
      const housing = HOUSING_OPTIONS.find(h=>h.id===S.housingId);
      const job = JOB_OPTIONS.find(j=>j.id===S.jobId) || JOB_OPTIONS.find(j=>j.id==="unemployed");

      return (
        <div className="frame">
          <div className="screen">
            <div className="notch"></div>

            {S.phase !== "onboarding" && (
              <div className="topbar">
                <div>ç¬¬ {S.week} é€±</div>
                <div className="pill">
                  <span><span className="k">AP</span> <span className="v">{S.ap}/{S.maxAp}</span></span>
                  <span><span className="k">è³‡å®‰</span> <span className="v">{S.security}</span></span>
                  <span><span className="k">å¿ƒæƒ…</span> <span className="v">{S.mood}</span></span>
                  <span><span className="k">é«”åŠ›</span> <span className="v">{S.health}</span></span>
                </div>
              </div>
            )}

            {/* ONBOARDING */}
            {S.phase === "onboarding" && (
              <div className="page">
                <div className="content">
                  <div className="h1">è‡ªç«‹å¤§å†’éšª</div>
                  <div className="sub">å‘½é‹è½‰ç›¤ï¼šæ±ºå®šä½ çš„å‡ºèº«</div>

                  {!S.spinResult ? (
                    <>
                      <div className="wheel-wrap">
                        <div className="wheel-shell">
                          <div className="pointer"></div>
                          <div className={"wheel " + (S.spinning ? "spinning":"")}></div>
                        </div>
                      </div>

                      <button className="btn" onClick={spin}>
                        {S.spinning ? "å‘½é‹è½‰å‹•ä¸­..." : "é–‹å§‹è½‰å‹• (START)"}
                      </button>

                      <button className="btn btn-secondary" style={{marginTop:10}} onClick={()=>{
                        const saved = loadSave();
                        if(saved && saved.state && saved.state.phase === "home"){
                          setS({...INITIAL, ...saved.state, modal:null, spinning:false});
                        }else{
                          add("ç›®å‰æ²’æœ‰å¯è¼‰å…¥çš„å­˜æª”ã€‚");
                        }
                      }}>
                        è¼‰å…¥å­˜æª”ï¼ˆè‹¥æœ‰ï¼‰
                      </button>
                    </>
                  ) : (
                    <div className="card">
                      <div className="row">
                        <div className="col">
                          <div className="label">å¹´é½¡</div>
                          <div className="big">{S.spinResult.age} æ­²</div>
                        </div>
                        <div className="col">
                          <div className="label">åˆå§‹å­˜æ¬¾</div>
                          <div className="big">${S.spinResult.money}</div>
                        </div>
                      </div>

                      <div style={{marginTop:10}}>
                        <span className="badge">ç­‰ç´š {S.spinResult.grade}</span>
                        <div className="hint" style={{marginTop:6, fontSize:14, color:"#222"}}>
                          {S.spinResult.desc}
                        </div>
                      </div>

                      <div style={{marginTop:12}} className="row">
                        <button className="btn btn-secondary col" onClick={restart}>é‡æ–°è½‰ä¸€æ¬¡</button>
                        <button className="btn col" onClick={choosePassword}>é€²å…¥ç¬¬ä¸€é—œ</button>
                      </div>
                    </div>
                  )}
                </div>

                <div className="footer" style={{height:260, minHeight:260}}>
                  <div className="log-title">
                    <span>SYSTEM LOGS</span>
                    <span style={{opacity:.8}}>â— ONLINE</span>
                  </div>
                  <div className="logs">
                    {S.logs.map((l, i) => <div className="log" key={i}>{l}</div>)}
                  </div>
                </div>
              </div>
            )}

            {/* HOME */}
            {S.phase === "home" && (
              <div className="page">
                <div className="money-bar">
                  <div className="money-title">
                    <span>å¯ç”¨é¤˜é¡ (FUNDS)</span>
                    <span className="badge gray">é€±æ¬¡ {S.week}/{S.maxWeeks}</span>
                  </div>

                  <div className="money">
                    <span>${S.money}</span>
                    <span className="mini">
                      <span className="badge vio">å„²è“„ ${S.savings}</span>
                      <span className="badge gray">å±…ä½ï¼š{housing ? housing.name : "æœªé¸"}</span>
                      <span className="badge gray">å·¥ä½œï¼š{job.name}</span>
                    </span>
                  </div>
                </div>

                <div className="content" style={{padding:14}}>
                  {/* Quick Actions */}
                  <div className="card" style={{boxShadow:"var(--shadow-sm)"}}>
                    <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", gap:10}}>
                      <div style={{fontWeight:900}}>æœ¬é€±æ“ä½œ</div>
                      <div style={{display:"flex", gap:8, flexWrap:"wrap", justifyContent:"flex-end"}}>
                        <span className={"badge " + (S.activeEvent ? "bad":"ok")}>
                          äº‹ä»¶ï¼š{S.activeEvent ? "å¾…è™•ç†" : "å·²è™•ç†"}
                        </span>
                        <span className="badge info">AP {S.ap}/{S.maxAp}</span>
                      </div>
                    </div>

                    <div className="row" style={{marginTop:10}}>
                      <button className="btn btn-blue col" onClick={openEvent} disabled={!S.activeEvent}>
                        è™•ç†äº‹ä»¶ï¼ˆAPä¾é¸é …ï¼‰
                      </button>
                      <button className="btn btn-secondary col" onClick={openStatus}>
                        èº«åˆ†ç¢ºèª
                      </button>
                    </div>

                    <div className="row" style={{marginTop:10}}>
                      <button className="btn btn-orange col" onClick={openShop}>
                        å•†åº—ï¼ˆä¸æ‰£APï¼‰
                      </button>
                      <button className="btn btn-green col" onClick={endWeek} disabled={gameOver.over}>
                        çµæŸæœ¬é€±ï¼ˆé€±çµç®—ï¼‰
                      </button>
                    </div>

                    {gameOver.over && (
                      <button className="btn btn-vio" style={{marginTop:10}} onClick={openEnding}>
                        æŸ¥çœ‹çµç®—ç¸½è©•
                      </button>
                    )}
                  </div>

                  {/* App Grid */}
                  <div className="grid" style={{padding:"14px 0 0"}}>
                    <div className="app orange" onClick={openHousing}>
                      <div className="icon">ğŸ </div>
                      ç§Ÿå±‹ä¸­å¿ƒ
                      <div className="hint">æŠ¼é‡‘/æˆ¿ç§Ÿ/å®‰å…¨</div>
                    </div>
                    <div className="app blue" onClick={openJob}>
                      <div className="icon">ğŸ’¼</div>
                      äººåŠ›éŠ€è¡Œ
                      <div className="hint">å·¥ä½œ/æ”¶å…¥/å£“åŠ›</div>
                    </div>
                    <div className="app green" onClick={openResource}>
                      <div className="icon">ğŸ—ºï¸</div>
                      è³‡æºåœ°åœ–
                      <div className="hint">æ”¯æŒ/è£œåŠ©/è«®è©¢</div>
                    </div>
                    <div className="app purple" onClick={openFinance}>
                      <div className="icon">ğŸ’³</div>
                      è²¡å‹™ç®¡å®¶
                      <div className="hint">é ç®—/å„²è“„/æ¸¬é©—</div>
                    </div>
                  </div>
                </div>

                <div className="footer">
                  <div className="log-title">
                    <span>SYSTEM LOGS</span>
                    <span style={{opacity:.8}}>â— ONLINE</span>
                  </div>
                  <div className="logs">
                    {S.logs.map((l, i) => <div className="log" key={i}>{l}</div>)}
                  </div>
                </div>
              </div>
            )}

            {/* Modal */}
            {S.modal && (
              <div className="overlay">
                <div className="modal">
                  <div className="modal-title">{S.modal.title}</div>
                  <div style={{fontWeight:900, marginTop:6}}>{S.modal.body}</div>

                  {S.modal.render ? (
                    <div style={{marginTop:10}}>{S.modal.render()}</div>
                  ) : (
                    <div>
                      {(S.modal.options || []).map((op, idx)=>(
                        <button key={idx} className="opt" onClick={op.action}>{op.label}</button>
                      ))}
                      <button className="opt" onClick={closeModal}>é—œé–‰</button>
                    </div>
                  )}
                </div>
              </div>
            )}

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
